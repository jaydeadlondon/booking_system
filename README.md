# üé´ High-Load Booking Service

![Python](https://img.shields.io/badge/Python-3.11-blue?style=flat&logo=python&logoColor=white)
![FastAPI](https://img.shields.io/badge/FastAPI-0.109-009688?style=flat&logo=fastapi&logoColor=white)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-15-336791?style=flat&logo=postgresql&logoColor=white)
![Redis](https://img.shields.io/badge/Redis-7.0-DC382D?style=flat&logo=redis&logoColor=white)
![Celery](https://img.shields.io/badge/Celery-5.3-37814A?style=flat&logo=celery&logoColor=white)
![Docker](https://img.shields.io/badge/Docker-2496ED?style=flat&logo=docker&logoColor=white)

Backend-—Å–µ—Ä–≤–∏—Å –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤, —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø–æ–¥ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π.
**–ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç Race Conditions (—Å–æ—Å—Ç–æ—è–Ω–∏—è –≥–æ–Ω–∫–∏) –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –ø–æ–∫—É–ø–∫–µ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ —Å–æ—Ç–Ω—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

---

## üî• –ü—Ä–æ–±–ª–µ–º–∞—Ç–∏–∫–∞ –∏ –†–µ—à–µ–Ω–∏–µ

–í —Å–∏—Å—Ç–µ–º–∞—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∞–º–∞—è –∫—Ä–∏—Ç–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞ ‚Äî **Overselling** (–ø—Ä–æ–¥–∞–∂–∞ –æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ª—é–¥—è–º). –≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —á–∏—Ç–∞—é—Ç —Å—Ç–∞—Ç—É—Å –º–µ—Å—Ç–∞ –∫–∞–∫ "–°–≤–æ–±–æ–¥–Ω–æ" –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –ø–µ—Ä–≤–∞—è —É—Å–ø–µ–ª–∞ –∑–∞–ø–∏—Å–∞—Ç—å "–ó–∞–Ω—è—Ç–æ".

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:

1.  **Concurrency Control**

2.  **High Performance Reads**

3.  **Data Consistency**

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

*   **Core:** Python 3.11, FastAPI
*   **Database:** PostgreSQL 15, SQLAlchemy 2.0 (Async)
*   **Broker & Cache:** Redis
*   **Background Tasks:** Celery + Celery Beat
*   **Migrations:** Alembic
*   **Testing:** Custom Concurrency Script

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∏—Ä–æ–≤–∞–Ω.

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ:
```ini
PROJECT_NAME=BookingSystem
POSTGRES_SERVER=db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=booking_db
POSTGRES_PORT=5432
REDIS_URL=redis://redis:6379/0
```

### 2. –ó–∞–ø—É—Å–∫
```bash
docker-compose up -d --build
```

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–ö–æ–Ω—Ü–µ—Ä—Ç + 50 –º–µ—Å—Ç):

```bash
# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
docker-compose exec app alembic upgrade head

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
curl -X POST http://localhost:8000/api/init_db
```

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000/docs

---

## üß™ –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Proof of Concept)

–í –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å —Å–∫—Ä–∏–ø—Ç `attack.py`, –∫–æ—Ç–æ—Ä—ã–π —ç–º—É–ª–∏—Ä—É–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—É—é –∞—Ç–∞–∫—É.
–û–Ω –∑–∞–ø—É—Å–∫–∞–µ—Ç 50 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –º–µ—Å—Ç–∞.

**–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞:**

```bash
pip install aiohttp
python attack.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

```
üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞—Ç–∞–∫–∏:
‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö –±—Ä–æ–Ω–µ–π: 1
üõ°Ô∏è –û—Ç–∫–ª–æ–Ω–µ–Ω–æ (–∑–∞–Ω—è—Ç–æ): 49
```

–≠—Ç–æ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

---

## üì° –û—Å–Ω–æ–≤–Ω—ã–µ –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| GET | `/api/events` | –°–ø–∏—Å–æ–∫ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π |
| GET | `/api/events/{id}/seats` | –°—Ö–µ–º–∞ –∑–∞–ª–∞ (–∏–∑ Redis Cache) |
| POST | `/api/book/safe` | –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π) |
| POST | `/api/bookings/{id}/pay` | –≠–º—É–ª—è—Ü–∏—è –æ–ø–ª–∞—Ç—ã –∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –±—Ä–æ–Ω–∏ |

## üë§ –ê–≤—Ç–æ—Ä

jaydeadlondon

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License